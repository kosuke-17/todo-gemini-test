# Todo 検索機能の設計

## 1. 概要

アプリケーション内の Todo リストから特定の Todo を素早く見つけるための検索機能を実装します。ユーザーはキーワード検索、フィルタリング、複合条件検索などの機能を使用して、必要な Todo を効率的に見つけることができます。

## 2. 機能要件

### 基本検索機能

- テキスト検索: Todo 内容（content）のキーワード検索
- 状態フィルタ: 完了/未完了状態でのフィルタリング
- 優先度フィルタ: 優先度によるフィルタリング（既存のフィルタと統合）
- 期限フィルタ: 期限日付の範囲検索（今日まで、今週まで、特定の日付範囲など）

### 高度な検索機能

- 複合条件検索: 複数の条件を組み合わせた検索
- 検索履歴: 過去の検索条件の保存と再利用
- ソート機能: 検索結果の並べ替え（既存のソート機能と統合）

## 3. UI/UX 設計

### 検索インターフェース

- 検索バー: 上部に配置し、常に表示
- フィルターパネル: 展開可能な詳細検索オプション
- 検索結果表示: 現在の検索条件に一致する Todo 数を表示

### インタラクション

- リアルタイム検索: 入力しながら結果を更新（クライアントサイドフィルタリング）
- クリアボタン: 検索条件をリセット
- 検索条件の視覚的表現: 適用されているフィルタをタグ形式で表示

## 4. データ構造と検索ロジック

### クライアントサイド検索（基本実装）

- クライアント側で Todo リストをフィルタリング
- 正規表現を使用したテキスト検索
- 複数の検索条件を論理的に組み合わせた検索ロジック

### サーバーサイド検索（拡張オプション）

- Prisma クエリを使用したデータベース検索
- 全文検索インデックスの活用（PostgreSQL の場合）
- ページネーション処理による大量データの効率的な検索

## 5. コンポーネント設計

### 新規コンポーネント

- `TodoSearch`: 検索バーと詳細検索オプションを含むコンポーネント
- `SearchFilter`: 検索フィルターの UI
- `ActiveFilters`: 適用中のフィルターを表示するコンポーネント

### 既存コンポーネントの修正

- `TodoList`: 検索結果に基づいて Todo をフィルタリングするロジックを追加
- `AddTodoForm`: 検索バーとの配置調整

## 6. 実装詳細

### クライアントサイド検索関数

```typescript
// 実装例（実際のコードは書かない）
function searchTodos(todos, searchParams) {
  // テキスト検索、状態フィルタ、優先度フィルタ、期限フィルタの組み合わせ
}
```

### 検索パラメータの状態管理

- 検索条件を React の useState と useReducer で管理
- URL クエリパラメータとの連携（オプション）

## 7. 最適化戦略

### パフォーマンス

- デバウンス処理によるリアルタイム検索の最適化
- メモ化による再計算の防止
- 大量の Todo に対する検索の効率化（仮想化リスト、ページネーションなど）

### アクセシビリティ

- キーボードナビゲーション
- スクリーンリーダー対応
- 十分なコントラスト比

## 8. 実装手順

1. **検索状態の設計**

   - 検索パラメータの型定義
   - 検索状態を管理するカスタムフック作成

2. **基本的な検索コンポーネントの作成**

   - 検索バーコンポーネントの実装
   - 検索ロジックの実装（クライアントサイド）

3. **詳細検索フィルターの実装**

   - 完了状態フィルターの追加
   - 優先度フィルターの統合
   - 期限フィルターの実装

4. **TodoList コンポーネントの拡張**

   - 検索結果に基づくフィルタリングの統合
   - 検索条件が空の場合の処理

5. **検索結果の表示最適化**

   - 該当件数の表示
   - 検索条件に一致するキーワードのハイライト（オプション）
   - 「該当なし」状態の適切な処理

6. **検索 UI の改良**

   - フィルタータグの表示
   - モバイル対応のレスポンシブデザイン
   - アニメーションとトランジション

7. **テストと最適化**
   - 様々な検索シナリオのテスト
   - パフォーマンス最適化
   - ユーザーフィードバックに基づく改良

## 9. 拡張機能案

- 保存済み検索: よく使う検索条件を保存する機能
- 検索履歴: 最近使用した検索条件の履歴
- タグベース検索: Todo にタグを追加し、タグで検索できる機能
- 高度な日付検索: 相対的な日付範囲（「次週まで」「来月」など）
- 音声検索: 音声入力による検索（WebSpeech API を活用）
- AI ベース検索: 自然言語処理による意味検索（将来的な拡張）

## 10. UI 設計案

### 検索バー

```
+----------------------------------------+
| 🔍 Todoを検索...        [フィルター ▼] |
+----------------------------------------+
```

### 展開されたフィルターパネル

```
+----------------------------------------+
| 🔍 買い物                [フィルター ▼] |
+----------------------------------------+
| ステータス: [すべて] [完了] [未完了]    |
| 優先度: [すべて] [低] [中] [高] [最高]  |
| 期限: [すべて] [今日] [今週] [カスタム▼] |
| [クリア]                 [適用]        |
+----------------------------------------+
```

### アクティブフィルターの表示

```
+----------------------------------------+
| 検索結果: 3件 - フィルター:
| [✓ "買い物"] [✓ 未完了] [✓ 高優先度] [X]|
+----------------------------------------+
```
